export const metadata = {
  title: 'Unified System Architecture',
  description: 'Complete AICodeRally ecosystem architecture - Rally Stack, Rally AI, Agent Protocol, and Franchise System'
}

# AICodeRally â€” Unified System Architecture

**Version 1.0** Â· **Last Updated:** November 28, 2025

> **Master Reference:** [`UNIFIED_ARCHITECTURE.md`](https://github.com/AICodeRally/aicoderally-stack/blob/master/UNIFIED_ARCHITECTURE.md) in the main repository is the authoritative source for this documentation.

---

## Purpose

AICodeRally is **not one product.** It's an **ecosystem**:

- A **monorepo factory** ([Rally Stack](#rally-stack))
- A **multi-AI orchestrator** ([Rally AI](#rally-ai))
- A **module system** (Rally Modules)
- A **brand + franchise model** ([Franchise Layer](#franchise-layer))
- A **teaching environment**
- A **rapid-prototype engine** for real businesses

This page provides the complete system architecture that governs every technical and operational layer.

---

## System Overview

AICodeRally is built on a **dual-core architecture**:

```
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚         AICodeRally Ecosystem           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚  Rally Stack (Monorepo Factory)         â”‚
      â”‚  â€“ Next.js front-of-house               â”‚
      â”‚  â€“ Python "back-of-house" automation    â”‚
      â”‚  â€“ Rally Modules (plug-in Lego blocks)  â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚  Rally AI (Multi-AI Orchestrator)       â”‚
      â”‚  â€“ Claude (Architect)                   â”‚
      â”‚  â€“ Gemini (Strategist)                  â”‚
      â”‚  â€“ GPT-4/5 (Executor)                   â”‚
      â”‚  â€“ Vercel AI Gateway                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚  Agent Protocol                         â”‚
      â”‚  â€“ Claude Code + ChatGPT division       â”‚
      â”‚  â€“ .ai rules & memory system            â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚  Franchise Layers                       â”‚
      â”‚  â€“ Studio / Edge / Summit tiers         â”‚
      â”‚  â€“ Qualification & certification        â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚  Brand System (Racing Sloth Identity)   â”‚
      â”‚  â€“ mascots, palette, traits             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

The system is **modular, predictable, and scalable** to hundreds of modules and thousands of franchise installs.

### Design Principles

**Why This Architecture?**

1. **Metadata-First**: Modules are defined by metadata contracts, not implementation
2. **TypeScript + Python Split**: TypeScript for UI/UX, Python for automation/generation
3. **No Heroic Migrations**: Build forward, not backward
4. **AI-Native**: Every layer is designed to be AI-readable and AI-modifiable
5. **Franchise-Ready**: Can be replicated across 100+ franchise locations

### System Constraints & Guarantees

**Constraints:**

- All modules MUST follow the metadata contract
- All AI operations MUST use BYOK (Bring Your Own Key)
- All agents MUST follow .ai/ directory rules
- All UIs MUST use the Rally UI kit

**Guarantees:**

- Sub-60s feature design with Rally AI
- Zero-config module scaffolding
- Predictable deployment to Vercel
- Franchise-reproducible workflows

---

## Rally Stack (Monorepo Factory)

A **personal software factory** for generating working apps, modules, and prototypes at speed.

### Core Philosophy

- **TypeScript/Next.js** = what the user sees
- **Python** = automation, generation, orchestration
- **Modules** = Lego blocks (metadata-first, UI-second)
- **No heroic migrations** â€“ build forward, not backward

### Folder Structure

```
rally-stack/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ studio/                 # Main Next.js UI (Studio tier)
â”‚   â”œâ”€â”€ edge/                  # SMB app builder (Edge tier)
â”‚   â””â”€â”€ summit/                # Enterprise offering (Summit tier)
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                  # Contracts & types
â”‚   â”œâ”€â”€ ui/                    # Shared UI kit
â”‚   â””â”€â”€ modules/               # Real modules (pit-wall, consensus, etc.)
â”œâ”€â”€ tools/
â”‚   â”œâ”€â”€ rally-ai/             # Multi-AI orchestrator CLI
â”‚   â””â”€â”€ python/               # Automation layer
â”œâ”€â”€ .ai/                       # Agent control system
â””â”€â”€ docs/                      # Documentation
```

### Module Contract

Every module MUST export this structure:

```typescript
export const module: RallyModule = {
  meta: {
    id: string,              // kebab-case, unique
    name: string,            // Display name
    description: string,     // Short description
    version: string,         // Semantic versioning
    category: ModuleCategory, // Enum: AI | Data | Tools | etc
    route: string,           // /modules/[id]
  }
}
```

**Why Metadata-First?**
- Enables automatic registration
- Allows Python to scaffold without knowing implementation
- Makes modules AI-discoverable
- Supports franchise replication

**Learn More:**
- [Platform Overview](/platform) - Monorepo structure and tech stack
- [Module System](/modules) - Browse all modules
- [Module Lifecycle](/modules/lifecycle) - How to create modules

---

## Rally AI (Multi-Model Orchestrator)

Rally AI is a CLI that treats AI models like a team.

### Model Roles

- **Claude** â†’ Architect (deep technical, security, structure)
- **Gemini** â†’ Strategist (business logic, integration, enterprise requirements)
- **GPT-4/5** â†’ Executor (sprint plans, code details, tactical refinements)

This triad eliminates blind spots that a single model has.

### Commands

```bash
# Generate architecture
rally-ai design "feature-name" --context "requirements..."

# Create 4-week build plan
rally-ai sprint-plan "feature-name"

# Security & requirements audit
rally-ai validate "feature-name"

# Multi-agent debate
rally-ai collaborate "feature-name" --rounds 3

# Complete lifecycle in one command
rally-ai workflow "feature-name"
```

### Flow

```
User â†’ Rally AI â†’ MultiAIOrchestrator â†’ Providers
                              â†“
                     design-docs/
                     sprint-plans/
                     validation/
                     collaborations/
```

### Gateway Integration

The Vercel AI Gateway normalizes:
- Auth
- Logging
- Caching
- Provider switching
- Rate limits

The orchestrator automatically falls back to SDK mode if gateway is unavailable.

**Learn More:**
- [Rally AI Documentation](/tools/rally-ai) - Complete Rally AI guide
- [AI Gateway Integration](/integration/ai-gateway) - Setup and usage

---

## Agent Protocol (.ai Directory)

This is the behavioral OS of the AICodeRally agents.

### Files

- `SYSTEM.md` â†’ architectural rules
- `CURRENT_TASK.md` â†’ what the agents should focus on
- `AGENT_MEMORY.md` â†’ long-term patterns, decisions, preferences

### Agent Roles

**Claude Code:**
- Architecture
- Complex logic
- Reviews
- Migrations

**ChatGPT:**
- UI scaffolding
- Boilerplate
- Pattern replication
- Speed

### Handoff Protocol

1. ChatGPT builds scaffold
2. Claude reviews and corrects patterns
3. ChatGPT implements corrections
4. Claude approves
5. Commit & merge

**No side-channel divergence allowed.**

**Learn More:**
- [Agent Protocol Documentation](/development/agent-protocol) - Detailed handoff protocol

---

## Module Lifecycle (End-to-End)

```
Idea â†’ Create â†’ Register â†’ UI â†’ Logic â†’ Validation â†’ Deploy
```

### 1. Create

```bash
python tools/python/create_module.py id "Name" category
```

Generates:
- Folder
- Metadata
- Page
- Registry entry

### 2. Register

Auto-injected into `packages/modules/index.ts`.

### 3. UI

Built inside: `apps/studio/app/modules/[id]/page.tsx`

### 4. Logic

Goes in:
- `packages/core/` for shared logic
- `packages/ui/` for shared visuals
- Or module folder if needed

### 5. Validation

```bash
rally-ai validate "module-id"
```

### 6. Deployment

Vercel (Next.js) + optional Python host (Fly, Railway).

**Learn More:**
- [Module Lifecycle Guide](/modules/lifecycle) - Step-by-step module creation

---

## UX / UI System

### Principles

- Minimalist
- High contrast
- Racing-sloth aesthetic
- Colorful gradient accents
- Consistent spacing system
- No creative drift allowed

### UI Kit

Lives in `packages/ui`.

Components support:
- Tailwind
- Zero proprietary patterns
- Reuse across modules

### UX Contract

Every module page must include:
- Title
- Description
- Action area
- Metadata
- Breadcrumb back to /modules

**Learn More:**
- [Design System](/design-system) - Complete design system documentation

---

## DevOps & Environment

### Hosting

- **Next.js app** â†’ Vercel
- **Python tools** â†’ CLI, optional web dashboard (FastAPI)
- **Vector DB / Supabase** â†’ Optional

### Secrets

- AI keys
- Gateway OIDC token
- (Optional) Supabase keys

### OIDC Token Refresh

Every 12 hours:

```bash
vercel env pull
```

### Local Dev

```bash
pnpm dev --filter studio
python tools/python/create_module.py ...
```

**Learn More:**
- [Deployment Guide](/deployment) - Production deployment
- [Environment Variables](/deployment/environment-variables) - Complete env var reference

---

## Franchise Layer

AICodeRally is a product + franchise model based on the **3-6-âˆ Framework**.

### The 3-6-âˆ Framework

**Studio** = **3 Steps** (Ideate â†’ Create â†’ Validate)
**Edge** = **6 P's** (People, Process, Product, Performance, Pipeline, Platform)
**Summit** = **âˆ** (The 6 P's + Governance, Scale, Integration, Intelligence, Strategy, Change)

### Studio â€“ The App Layer (3 Steps)

**Goal:** Transform ideas into working apps

**The Loop:** Ideate â†’ Create â†’ Validate

**Outputs:** Scoping artifacts, prototype apps, business case mini-apps

### Edge â€“ The Business Layer (6 P's)

**Goal:** Turn apps into a Business OS

**The 6 Pillars:**
- **P1 â€” People:** Roles, permissions, stakeholders
- **P2 â€” Processes:** Workflows, task flows, delivery
- **P3 â€” Products:** Services, programs, offers
- **P4 â€” Performance:** KPIs, dashboards, analytics
- **P5 â€” Pipeline:** Lead management, lifecycle
- **P6 â€” Platform:** Tools, automations, billing

**Outputs:** Edge Solutions (npEdge, bhgEdge, Designer Biz Kit, Brand Hub)

### Summit â€“ The Enterprise Layer (âˆ)

**Goal:** System-of-systems transformation

**Extensions:**
- + Governance
- + Scale
- + Integration
- + Intelligence
- + Strategy
- + Change Management

**Outputs:** Summit Solutions, executive dashboards, enterprise orchestration

### Franchise Business Model

**Studio Tier:**
- Initial: $50k | Monthly: $2k | 10% project revenue
- Physical locations, full training

**Edge Tier:**
- Initial: $10k | Monthly: $500 | 5% project revenue
- Remote/virtual, online training

**Summit Tier:**
- Project-based: $100k+ | Retainer: $25k/month
- Enterprise consulting, custom licensing

**Learn More:**
- [Franchise Documentation](/franchise) - Complete 3-6-âˆ Framework and qualification process

---

## Business Model (Technical View)

AICodeRally creates multiple revenue streams:

### SaaS
- Rally AI BYOK
- Gateway cost
- Hosted modules

### Franchise Fees
- Initial fee
- Monthlies
- Training

### Module Marketplace
- Sell modules
- Upsell data integrations
- White-label partner modules

### Enterprise
- Summit tier
- Multi-agent AI coaching
- AI governance
- Internal app factories

---

## Brand & Identity System

### The Sloth Paradox

- **AI** = slow, relaxed, approachable sloth
- **Rally** = speed, racing, modern energy

This contrast is the core brand identity.

### Visual Keywords

- Racing goggles
- "Draped over logo" posture
- Neon gradients (cyan â†’ magenta)
- Playful but modern

**Learn More:**
- [Brand Guidelines](/brand) - Complete brand and identity system

---

## Glossary

| Term | Definition |
|------|------------|
| **Rally Stack** | Monorepo factory |
| **Rally AI** | Multi-AI orchestrator CLI |
| **Module** | Metadata-defined building block |
| **Agent Protocol** | Rules for interacting with AI assistants |
| **Studio** | Franchise offering (one idea â†’ one app) |
| **Edge** | SMB offering (business OS around apps) |
| **Summit** | Enterprise offering (custom, cross-app scale) |

---

## Related Documentation

### Application Architecture
- [Architecture 3.0](/architecture) - Four-layer application architecture (Modules â†’ Studio â†’ Edge â†’ Summit)

### Development
- [Getting Started](/getting-started) - Setup and first steps
- [Platform Overview](/platform) - Monorepo structure
- [Contributing](/development/contributing) - Contribution guidelines
- [Agent Protocol](/development/agent-protocol) - AI agent coordination

### Tools & Integration
- [Rally AI](/tools/rally-ai) - Multi-AI orchestrator documentation
- [AI Gateway](/integration/ai-gateway) - Vercel AI Gateway with BYOK
- [Module System](/modules) - Browse and create modules

### Deployment & Operations
- [Deployment Guide](/deployment) - Production deployment
- [Environment Variables](/deployment/environment-variables) - Configuration
- [Tech Stack](/tech-stack) - Technology deep dive

### Business & Brand
- [Franchise](/franchise) - Franchise tiers and certification
- [Design System](/design-system) - UX/UI standards
- [Brand Guidelines](/brand) - Brand identity and visual system

---

## Master Reference

This page is derived from the master architecture document:

**ğŸ“„ [`UNIFIED_ARCHITECTURE.md`](https://github.com/AICodeRally/aicoderally-stack/blob/master/UNIFIED_ARCHITECTURE.md)**

The master document in the main repository is the **single source of truth**. All other documentation must align with it.

When the master document changes â†’ the entire ecosystem documentation changes.

When something isn't defined in the master â†’ it doesn't exist yet.

---

## Final Notes

**If it's not in the UNIFIED_ARCHITECTURE.md â†’ it's not core to AICodeRally.**

For the complete technical specification with implementation details, architecture deep dives, and code examples, see the [master architecture document](https://github.com/AICodeRally/aicoderally-stack/blob/master/UNIFIED_ARCHITECTURE.md).
